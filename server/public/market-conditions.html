<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market Conditions Analysis</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .card h3 {
            margin-top: 0;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .parameter-table {
            width: 100%;
            border-collapse: collapse;
        }
        .parameter-table th, .parameter-table td {
            border: 1px solid #ddd;
            padding: 8px 12px;
            text-align: left;
        }
        .parameter-table th {
            background-color: #f5f5f5;
        }
        .btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 10px 0;
            cursor: pointer;
            border-radius: 4px;
        }
        .btn-secondary {
            background-color: #007bff;
        }
        .timezone-selector {
            margin: 10px 0;
            padding: 5px;
            font-size: 14px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        .navigation-links {
            margin-bottom: 20px;
        }
        .navigation-links a {
            margin-right: 15px;
            text-decoration: none;
            color: #007bff;
        }
        .navigation-links a:hover {
            text-decoration: underline;
        }
        .market-stat {
            font-size: 24px;
            font-weight: bold;
            margin: 5px 0;
        }
        .volatility-indicator {
            display: inline-block;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            margin-right: 10px;
            vertical-align: middle;
        }
        .low-volatility {
            background-color: #28a745;
        }
        .medium-volatility {
            background-color: #ffc107;
        }
        .high-volatility {
            background-color: #dc3545;
        }
        .metrics-container {
            margin-top: 15px;
        }
        .metric-box {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .metric-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .metric-value {
            font-size: 20px;
            font-weight: bold;
        }
        .chart-container {
            height: 200px;
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            position: relative;
        }
        .chart-placeholder {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <h1>Market Conditions Analysis</h1>
    
    <div class="navigation-links">
        <a href="http://localhost:3008/market-conditions.html" style="font-weight: bold;">Market Conditions Analysis</a>
        <a href="http://localhost:3008/recommendations.html">Template Recommendations</a>
        <a href="http://localhost:3008/risk-management.html">Risk Management Dashboard</a>
    </div>
    
    <div class="grid">
        <div>
            <div class="card">
                <h3>Current Market Conditions</h3>
                <div>
                    <label for="timezone-selector">Your Timezone:</label>
                    <select id="timezone-selector" class="timezone-selector">
                        <option value="US_CENTRAL">US Central</option>
                        <option value="US_EASTERN">US Eastern</option>
                        <option value="US_MOUNTAIN">US Mountain</option>
                        <option value="US_PACIFIC">US Pacific</option>
                        <option value="ASIA">Asia</option>
                        <option value="EUROPE">Europe</option>
                    </select>
                </div>
                <div id="current-conditions">
                    <p><strong>Session:</strong> <span id="current-session">Loading...</span></p>
                    <p>
                        <strong>Volatility:</strong> 
                        <span id="volatility-indicator" class="volatility-indicator low-volatility"></span>
                        <span id="current-volatility">Loading...</span>
                    </p>
                    <p><strong>Last Updated:</strong> <span id="last-updated">Loading...</span></p>
                </div>
                <button id="refresh-btn" class="btn">Refresh Analysis</button>
                <a href="http://localhost:3008/recommendations.html" class="btn btn-secondary">View Recommendations</a>
            </div>
            
            <div class="card">
                <h3>Market Metrics</h3>
                <div class="metrics-container">
                    <div class="metric-box">
                        <div class="metric-title">Range (Points)</div>
                        <div class="metric-value" id="range-value">...</div>
                    </div>
                    <div class="metric-box">
                        <div class="metric-title">Average Volume</div>
                        <div class="metric-value" id="volume-value">...</div>
                    </div>
                    <div class="metric-box">
                        <div class="metric-title">Trend Strength</div>
                        <div class="metric-value" id="trend-strength">...</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div>
            <div class="card">
                <h3>Volatility Trend (24h)</h3>
                <div class="chart-container" id="volatility-chart">
                    <div class="chart-placeholder">
                        <i>Volatility trend data will appear here</i>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h3>Volume Profile</h3>
                <div class="chart-container" id="volume-chart">
                    <div class="chart-placeholder">
                        <i>Volume profile data will appear here</i>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h3>Session Analysis</h3>
                <table class="parameter-table">
                    <tr>
                        <th>Session</th>
                        <th>Average Volatility</th>
                        <th>Trade Count</th>
                    </tr>
                    <tr>
                        <td>US Opening</td>
                        <td id="us-open-volatility">...</td>
                        <td id="us-open-trades">...</td>
                    </tr>
                    <tr>
                        <td>US Midday</td>
                        <td id="us-midday-volatility">...</td>
                        <td id="us-midday-trades">...</td>
                    </tr>
                    <tr>
                        <td>US Afternoon</td>
                        <td id="us-afternoon-volatility">...</td>
                        <td id="us-afternoon-trades">...</td>
                    </tr>
                    <tr>
                        <td>Overnight</td>
                        <td id="overnight-volatility">...</td>
                        <td id="overnight-trades">...</td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Set default timezone to US Central
            document.getElementById('timezone-selector').value = 'US_CENTRAL';
            
            // Initial load
            loadMarketConditions();
            
            // Setup event listeners
            document.getElementById('refresh-btn').addEventListener('click', loadMarketConditions);
            document.getElementById('timezone-selector').addEventListener('change', loadMarketConditions);
            
            // Function to load current market conditions
            function loadMarketConditions() {
                const timezone = document.getElementById('timezone-selector').value;
                
                fetch(`/api/market-conditions?timezone=${timezone}`)
                    .then(response => response.json())
                    .then(data => {
                        // Display current conditions
                        document.getElementById('current-session').textContent = 
                            data.currentSession || 'undefined';
                        document.getElementById('current-volatility').textContent = 
                            data.volatilityCategory || 'undefined';
                        document.getElementById('last-updated').textContent = 
                            new Date(data.currentTime).toLocaleString();
                        
                        // Update volatility indicator
                        updateVolatilityIndicator(data.volatilityCategory);
                        
                        // Update market metrics
                        if (data.metrics) {
                            document.getElementById('range-value').textContent = 
                                data.metrics.range ? data.metrics.range.toFixed(1) : '...';
                            document.getElementById('volume-value').textContent = 
                                data.metrics.averageVolume ? data.metrics.averageVolume.toLocaleString() : '...';
                            document.getElementById('trend-strength').textContent = 
                                data.metrics.trendStrength ? data.metrics.trendStrength.toFixed(2) : '...';
                        }
                        
                        // Update session analysis
                        if (data.sessionAnalysis) {
                            updateSessionMetrics(data.sessionAnalysis);
                        }
                        
                        // Mock update charts (in real implementation, you would use a charting library)
                        updateMockCharts(data);
                    })
                    .catch(error => {
                        console.error('Error fetching market conditions:', error);
                    });
            }
            
            // Function to update volatility indicator
            function updateVolatilityIndicator(volatilityCategory) {
                const indicator = document.getElementById('volatility-indicator');
                indicator.className = 'volatility-indicator';
                
                if (volatilityCategory === 'LOW_VOLATILITY') {
                    indicator.classList.add('low-volatility');
                } else if (volatilityCategory === 'MEDIUM_VOLATILITY') {
                    indicator.classList.add('medium-volatility');
                } else if (volatilityCategory === 'HIGH_VOLATILITY') {
                    indicator.classList.add('high-volatility');
                }
            }
            
            // Function to update session metrics
            function updateSessionMetrics(sessionData) {
                // This would use actual data in a real implementation
                // For now, using placeholder values if no data is available
                document.getElementById('us-open-volatility').textContent = 
                    sessionData.usOpen ? sessionData.usOpen.volatility : 'Medium';
                document.getElementById('us-open-trades').textContent = 
                    sessionData.usOpen ? sessionData.usOpen.tradeCount : '32';
                
                document.getElementById('us-midday-volatility').textContent = 
                    sessionData.usMidDay ? sessionData.usMidDay.volatility : 'Low';
                document.getElementById('us-midday-trades').textContent = 
                    sessionData.usMidDay ? sessionData.usMidDay.tradeCount : '18';
                
                document.getElementById('us-afternoon-volatility').textContent = 
                    sessionData.usAfternoon ? sessionData.usAfternoon.volatility : 'Medium';
                document.getElementById('us-afternoon-trades').textContent = 
                    sessionData.usAfternoon ? sessionData.usAfternoon.tradeCount : '24';
                
                document.getElementById('overnight-volatility').textContent = 
                    sessionData.overnight ? sessionData.overnight.volatility : 'Low';
                document.getElementById('overnight-trades').textContent = 
                    sessionData.overnight ? sessionData.overnight.tradeCount : '12';
            }
            
            // Function to update mock charts
            function updateMockCharts(data) {
                // In a real implementation, you would use a charting library like Chart.js
                // For now, just update the placeholder text
                document.querySelector('#volatility-chart .chart-placeholder').innerHTML = 
                    `<i>Volatility data for ${data.currentSession || 'current session'} loaded</i>`;
                document.querySelector('#volume-chart .chart-placeholder').innerHTML = 
                    `<i>Volume profile for ${data.currentSession || 'current session'} loaded</i>`;
            }
        });
    </script>
</body>
</html>